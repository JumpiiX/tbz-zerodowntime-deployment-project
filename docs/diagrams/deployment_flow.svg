<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 800 600">
  <!-- Styles -->
  <defs>
    <style>
      .bg-rect { fill: #f5f5f5; stroke: #ccc; }
      .box { fill: white; stroke: #333; stroke-width: 2; rx: 5; }
      .blue-box { fill: #cceeff; stroke: #0077cc; stroke-width: 2; rx: 5; }
      .green-box { fill: #ccffcc; stroke: #00aa44; stroke-width: 2; rx: 5; }
      .arrow { fill: none; stroke: #666; stroke-width: 2; marker-end: url(#arrowhead); }
      .label { font-family: Arial, sans-serif; font-size: 12px; text-anchor: middle; }
      .title { font-family: Arial, sans-serif; font-size: 14px; font-weight: bold; text-anchor: middle; }
      .component { font-family: Arial, sans-serif; font-size: 12px; font-weight: bold; text-anchor: middle; }
      .small-text { font-family: Arial, sans-serif; font-size: 10px; text-anchor: middle; }
      .code { font-family: Courier, monospace; font-size: 10px; text-anchor: middle; }
    </style>
    
    <!-- Arrow marker -->
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#666" />
    </marker>
  </defs>
  
  <!-- Background -->
  <rect width="800" height="600" class="bg-rect" />
  
  <!-- Title -->
  <text x="400" y="30" class="title">Zero-Downtime Deployment Flow mit Blue-Green Strategie</text>
  
  <!-- GitHub Repository -->
  <g transform="translate(100, 80)">
    <rect width="120" height="60" class="box" />
    <text x="60" y="35" class="component">GitHub Repository</text>
    <text x="60" y="50" class="small-text">penumbra-explorer-backend</text>
  </g>
  
  <!-- GitHub Actions -->
  <g transform="translate(100, 180)">
    <rect width="120" height="60" class="box" />
    <text x="60" y="35" class="component">GitHub Actions</text>
    <text x="60" y="50" class="small-text">CI/CD Pipeline</text>
  </g>
  
  <!-- Docker Build -->
  <g transform="translate(100, 280)">
    <rect width="120" height="60" class="box" />
    <text x="60" y="35" class="component">Docker Build</text>
    <text x="60" y="50" class="small-text">Container Image erstellen</text>
  </g>
  
  <!-- Server Environment -->
  <rect x="260" y="60" width="500" height="480" rx="10" stroke="#888" stroke-width="2" stroke-dasharray="5,5" fill="none" />
  <text x="510" y="80" class="title">Ubuntu Server (Hetzner Cloud)</text>
  
  <!-- Deploy Script -->
  <g transform="translate(300, 120)">
    <rect width="120" height="60" class="box" />
    <text x="60" y="35" class="component">deploy.sh</text>
    <text x="60" y="50" class="small-text">Deployment Script</text>
  </g>
  
  <!-- Blue Environment -->
  <g transform="translate(300, 300)">
    <rect width="120" height="80" class="blue-box" />
    <text x="60" y="30" class="component">Blue Environment</text>
    <text x="60" y="50" class="small-text">Aktiver Docker Container</text>
    <text x="60" y="65" class="small-text">mit Blockchain-Indexer</text>
  </g>
  
  <!-- Green Environment -->
  <g transform="translate(300, 420)">
    <rect width="120" height="80" class="green-box" />
    <text x="60" y="30" class="component">Green Environment</text>
    <text x="60" y="50" class="small-text">Neuer Docker Container</text>
    <text x="60" y="65" class="small-text">mit Blockchain-Indexer</text>
  </g>
  
  <!-- Monitor Script -->
  <g transform="translate(500, 240)">
    <rect width="120" height="60" class="box" />
    <text x="60" y="35" class="component">monitor.sh</text>
    <text x="60" y="50" class="small-text">Synchronisations-Check</text>
  </g>
  
  <!-- NGINX Proxy -->
  <g transform="translate(600, 370)">
    <rect width="120" height="60" class="box" />
    <text x="60" y="35" class="component">NGINX</text>
    <text x="60" y="50" class="small-text">Reverse Proxy</text>
  </g>
  
  <!-- Users -->
  <g transform="translate(600, 500)">
    <rect width="120" height="60" class="box" />
    <text x="60" y="35" class="component">Endbenutzer</text>
    <text x="60" y="50" class="small-text">Explorer & API Clients</text>
  </g>
  
  <!-- Arrows -->
  <!-- GitHub flow -->
  <line x1="160" y1="110" x2="160" y2="180" class="arrow" />
  <line x1="160" y1="240" x2="160" y2="280" class="arrow" />
  <line x1="220" y1="310" x2="280" y2="150" class="arrow" />
  
  <!-- Deploy to environments -->
  <line x1="360" y1="180" x2="360" y2="300" class="arrow" />
  <line x1="330" y1="180" x2="330" y2="420" class="arrow" />
  
  <!-- Monitoring flow -->
  <line x1="420" y1="340" x2="500" y2="270" class="arrow" />
  <line x1="420" y1="420" x2="485" y2="300" class="arrow" />
  
  <!-- Switch flow -->
  <line x1="560" y1="300" x2="600" y2="370" class="arrow" />
  
  <!-- User traffic -->
  <line x1="660" y1="430" x2="660" y2="500" class="arrow" />
  
  <!-- Additional connections -->
  <line x1="600" y1="400" x2="420" y2="340" stroke="#0077cc" stroke-width="2" stroke-dasharray="3,3" marker-end="url(#arrowhead)" />
  <line x1="580" y1="400" x2="420" y2="460" stroke="#00aa44" stroke-width="2" stroke-dasharray="3,3" marker-end="url(#arrowhead)" />
  
  <!-- Code snippets -->
  <g transform="translate(430, 190)">
    <rect width="160" height="40" fill="#f9f9f9" stroke="#ddd" rx="3" />
    <text x="80" y="15" class="code">./deploy.sh --environment=green</text>
    <text x="80" y="30" class="code">docker-compose up -d green</text>
  </g>
  
  <g transform="translate(500, 310)">
    <rect width="180" height="40" fill="#f9f9f9" stroke="#ddd" rx="3" />
    <text x="90" y="15" class="code">./monitor.sh --check-sync</text>
    <text x="90" y="30" class="code">if [[ $SYNC_COMPLETE ]]; then...</text>
  </g>
  
  <g transform="translate(490, 440)">
    <rect width="180" height="25" fill="#f9f9f9" stroke="#ddd" rx="3" />
    <text x="90" y="17" class="code">./switch.sh blue green</text>
  </g>
  
  <!-- Legend -->
  <g transform="translate(30, 520)">
    <rect width="15" height="15" class="blue-box" x="0" y="0" />
    <text x="25" y="12" class="small-text" text-anchor="start">Aktive "Blue" Umgebung</text>
    
    <rect width="15" height="15" class="green-box" x="0" y="25" />
    <text x="25" y="37" class="small-text" text-anchor="start">Neue "Green" Umgebung</text>
    
    <rect width="15" height="15" class="box" x="0" y="50" />
    <text x="25" y="62" class="small-text" text-anchor="start">Komponenten & Skripte</text>
    
    <line x1="0" y1="82" x2="15" y2="82" stroke="#0077cc" stroke-width="2" stroke-dasharray="3,3" />
    <text x="25" y="85" class="small-text" text-anchor="start">Aktiver Traffic-Pfad</text>
    
    <line x1="0" y1="100" x2="15" y2="100" stroke="#00aa44" stroke-width="2" stroke-dasharray="3,3" />
    <text x="25" y="103" class="small-text" text-anchor="start">Neuer Traffic-Pfad nach Switch</text>
  </g>

  <!-- Flow description -->
  <g transform="translate(400, 570)">
    <text x="0" y="0" class="small-text" text-anchor="middle">Zero-Downtime Deployment Ablauf: Code-Push → CI/CD Pipeline → Docker Build → Server Deployment → Synchronisation → Monitoring → NGINX Traffic-Switch</text>
  </g>
</svg>
